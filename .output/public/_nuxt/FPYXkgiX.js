const $=[[/^(<!--)(.+)(-->)$/,!1],[/^(\/\*)(.+)(\*\/)$/,!1],[/^(\/\/|["'#]|;{1,2}|%{1,2}|--)(.*)$/,!0],[/^(\*)(.+)$/,!0]];function O(n,i){if(n.type!=="element")return!1;const e=n.children[0];return e.type==="text"&&e.value.trim()===i}function P(n,i){let e=n.trimStart();const r=n.length-e.length;e=e.trimEnd();const f=n.length-e.length-r;for(const[d,p]of $){if(p&&!i)continue;const m=d.exec(e);if(m)return[" ".repeat(r)+m[1],m[2],m[3]?m[3]+" ".repeat(f):void 0]}}function C(n){const i=n.match(/(?:\/\/|["'#]|;{1,2}|%{1,2}|--)(\s*)$/);return i&&i[1].trim().length===0?n.slice(0,i.index):n}function N(n,i,e,r){return r==null&&(r="v3"),{name:n,code(f){const d=f.children.filter(t=>t.type==="element"),p=[];f.data??={};const m=f.data;m._shiki_notation??=(function(t,c,a){const s=[];for(const o of t){if(a==="v3"){const h=o.children.flatMap((l,k)=>{if(l.type!=="element")return l;const v=l.children[0];if(v.type!=="text")return l;const x=k===o.children.length-1;if(!P(v.value,x))return l;const g=v.value.split(/(\s+\/\/)/);if(g.length<=1)return l;let y=[g[0]];for(let A=1;A<g.length;A+=2)y.push(g[A]+(g[A+1]||""));return y=y.filter(Boolean),y.length<=1?l:y.map(A=>({...l,children:[{type:"text",value:A}]}))});h.length!==o.children.length&&(o.children=h)}const u=o.children;let j=u.length-1;a==="v1"?j=0:c&&(j=u.length-2);for(let h=Math.max(j,0);h<u.length;h++){const l=u[h];if(l.type!=="element")continue;const k=l.children.at(0);if(k?.type!=="text")continue;const v=h===u.length-1,x=P(k.value,v);if(x)if(c&&!v&&h!==0){const g=O(u[h-1],"{")&&O(u[h+1],"}");s.push({info:x,line:o,token:l,isLineCommentOnly:u.length===3&&l.children.length===1,isJsxStyle:g})}else s.push({info:x,line:o,token:l,isLineCommentOnly:u.length===1&&l.children.length===1,isJsxStyle:!1})}}return s})(d,["jsx","tsx"].includes(this.options.lang),r);const L=m._shiki_notation;for(const t of L){if(t.info[1].length===0)continue;let c=d.indexOf(t.line);t.isLineCommentOnly&&r!=="v1"&&c++;let a=!1;if(t.info[1]=t.info[1].replace(i,(...o)=>e.call(this,o,t.line,t.token,d,c)?(a=!0,""):o[0]),!a)continue;r==="v1"&&(t.info[1]=C(t.info[1]));const s=t.info[1].trim().length===0;if(s&&(t.info[1]=""),s&&t.isLineCommentOnly)p.push(t.line);else if(s&&t.isJsxStyle)t.line.children.splice(t.line.children.indexOf(t.token)-1,3);else if(s)t.line.children.splice(t.line.children.indexOf(t.token),1);else{const o=t.token.children[0];o.type==="text"&&(o.value=t.info.join(""))}}for(const t of p){const c=f.children.indexOf(t),a=f.children[c+1];let s=1;a?.type==="text"&&a?.value===`
`&&(s=2),f.children.splice(c,s)}}}}function S(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function M(n={},i="@shikijs/transformers:notation-map"){const{classMap:e={},classActivePre:r}=n;return N(i,new RegExp(`\\s*\\[!code (${Object.keys(e).map(S).join("|")})(:\\d+)?\\]`),function([f,d,p=":1"],m,L,t,c){const a=Number.parseInt(p.slice(1),10);for(let s=c;s<Math.min(c+a,t.length);s++)this.addClassToHast(t[s],e[d]);return r&&this.addClassToHast(this.pre,r),!0},n.matchAlgorithm)}function _(n={}){const{classLineAdd:i="diff add",classLineRemove:e="diff remove",classActivePre:r="has-diff"}=n;return M({classMap:{"++":i,"--":e},classActivePre:r,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-diff")}function w(n={}){const{classMap:i={error:["highlighted","error"],warning:["highlighted","warning"]},classActivePre:e="has-highlighted"}=n;return M({classMap:i,classActivePre:e,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-error-level")}function E(n={}){const{classActiveLine:i="focused",classActivePre:e="has-focused"}=n;return M({classMap:{focus:i},classActivePre:e,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-focus")}function H(n={}){const{classActiveLine:i="highlighted",classActivePre:e="has-highlighted"}=n;return M({classMap:{highlight:i,hl:i},classActivePre:e,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-highlight")}export{N as createCommentNotationTransformer,_ as transformerNotationDiff,w as transformerNotationErrorLevel,E as transformerNotationFocus,H as transformerNotationHighlight,M as transformerNotationMap};
